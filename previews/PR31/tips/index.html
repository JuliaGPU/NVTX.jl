<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Nsight Systems tips · NVTX.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NVTX.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">NVTX.jl</a></li><li><a class="tocitem" href="../api/">API</a></li><li class="is-active"><a class="tocitem" href>Nsight Systems tips</a><ul class="internal"><li><a class="tocitem" href="#MPI"><span>MPI</span></a></li><li><a class="tocitem" href="#Reducing-overhead"><span>Reducing overhead</span></a></li><li><a class="tocitem" href="#Querying-profiles"><span>Querying profiles</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Nsight Systems tips</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Nsight Systems tips</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGPU/NVTX.jl/blob/main/docs/src/tips.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Nsight-Systems-tips"><a class="docs-heading-anchor" href="#Nsight-Systems-tips">Nsight Systems tips</a><a id="Nsight-Systems-tips-1"></a><a class="docs-heading-anchor-permalink" href="#Nsight-Systems-tips" title="Permalink"></a></h1><h2 id="MPI"><a class="docs-heading-anchor" href="#MPI">MPI</a><a id="MPI-1"></a><a class="docs-heading-anchor-permalink" href="#MPI" title="Permalink"></a></h2><p>Nsight Systems can profile MPI operations, and can be used in two ways:</p><h3 id="Profiler-outside-launcher"><a class="docs-heading-anchor" href="#Profiler-outside-launcher">Profiler outside launcher</a><a id="Profiler-outside-launcher-1"></a><a class="docs-heading-anchor-permalink" href="#Profiler-outside-launcher" title="Permalink"></a></h3><pre><code class="nohighlight hljs">nsys profile &lt;launcher&gt; &lt;program&gt;</code></pre><p>In this approach, <code>nsys profile</code> calls the MPI launcher (e.g. <code>mpiexec</code>), which in turn calls the scipt:</p><pre><code class="nohighlight hljs">nsys profile --trace=nvtx,mpi --mpi-impl=openmpi mpiexec -n 2 julia --project mpi.jl</code></pre><p>This will generate one report for the whole run, but only works when all MPI processes are on the one machine.</p><h3 id="Launcher-outside-profiler"><a class="docs-heading-anchor" href="#Launcher-outside-profiler">Launcher outside profiler</a><a id="Launcher-outside-profiler-1"></a><a class="docs-heading-anchor-permalink" href="#Launcher-outside-profiler" title="Permalink"></a></h3><pre><code class="nohighlight hljs">&lt;launcher&gt; nsys profile &lt;program&gt;</code></pre><p>Alternativelym the launcher can be used to start multiple copies of the profiler, which will generate a report for each MPI process. You will need to specify a unique name for each file, which can be done by <code>--output=</code> with using <code>%q</code> to interpolate an environment variable. Most launchers will set the <code>MPI_COMM_WORLD</code> rank of each process as an environment variable (e.g. <code>PMI_RANK</code> or <code>OMPI_COMM_WORLD_RANK</code>).</p><pre><code class="nohighlight hljs">mpiexec -n 2 nsys profile --trace=nvtx,mpi --mpi-impl=openmpi --output=report.%q{OMPI_COMM_WORLD_RANK} julia --project mpi.jl</code></pre><p>This file can be opened as a &quot;multi-report view&quot;.</p><h2 id="Reducing-overhead"><a class="docs-heading-anchor" href="#Reducing-overhead">Reducing overhead</a><a id="Reducing-overhead-1"></a><a class="docs-heading-anchor-permalink" href="#Reducing-overhead" title="Permalink"></a></h2><p>The profiler itself has some overhead. Typically it will make use of another thread, but if there insufficient hardware resources available, it may result in occasionaly pauses in the program being profiled. </p><p>When using a HPC cluster scheduler such as Slurm, this can be reduced by allocating an additional CPU core per MPI process for the profiler (e.g. via the <code>--cpus-per-task</code> option in Slurm). To ensure that these are scheduled correctly, it is best to &quot;bind&quot; the CPU cores per task. If launching using <code>srun</code>, then use the <code>--cpu-bind=cores</code>; if launching using Open MPI <code>mpiexec</code>, use <code>--map-by node:PE=$cpus_per_task --bind-to core</code>.</p><h2 id="Querying-profiles"><a class="docs-heading-anchor" href="#Querying-profiles">Querying profiles</a><a id="Querying-profiles-1"></a><a class="docs-heading-anchor-permalink" href="#Querying-profiles" title="Permalink"></a></h2><p>If you need to query the profile data programatically, the easiest option is to first convert to make use of the Sqlite format, either by the <code>--export</code> argument, or using the <code>nsys export</code> command.</p><p>The format of the resulting file is documented in the <a href="https://docs.nvidia.com/nsight-systems/UserGuide/index.html#exporter-sqlite-schema">SQLite Schema Reference</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/">« API</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Sunday 9 July 2023 19:55">Sunday 9 July 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
